<!DOCTYPE html>
<html>

<head>
    <title>Locations in Taiping Town Marked by MySejahtera Hotspot</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <style>
        #map {
            height: 200%;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding-left: 20px;
            padding-right: 20px;
        }
    </style>
Last updated: <span id='DATE'></span>
<p>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>

        let map;
        zoom = {
            'perak': 15,
        }
        center = {
            'perak': [4.849045, 100.73785],
        }

        data = {
            //'perak': 'https://kalngyk.github.io/data/points.json-points-cases.json',
            'perak': 'https://kalngyk.github.io/data/locations.json',
        }
        
        colors = ['#009d9d', '#109d9c', '#1a9d9c', '#219d9b', '#279d9a', '#2c9d99', '#319e99', '#359e98', '#399e97', '#3c9e96', '#3f9e96', '#439e95', '#469e94', '#489e94', '#4b9e93', '#4e9e92', '#509e91', '#539e91', '#559e90', '#579f8f', '#5a9f8e', '#5c9f8e', '#5e9f8d', '#609f8c', '#629f8c', '#649f8b', '#669f8a', '#689f8a', '#699f89', '#6b9f88', '#6d9f87', '#6f9f87', '#709f86', '#729f85', '#739f85', '#759f84', '#779f83', '#789f83', '#7a9f82', '#7b9f81', '#7d9f80', '#7e9f80', '#7f9f7f', '#819f7e', '#829f7e', '#849f7d', '#859f7c', '#869f7c', '#889f7b', '#899f7a', '#8a9f7a', '#8b9f79', '#8d9f78', '#8e9f78', '#8f9f77', '#909f76', '#919f76', '#939f75', '#949e74', '#959e74', '#969e73', '#979e72', '#989e72', '#999e71', '#9b9e70', '#9c9e70', '#9d9e6f', '#9e9e6e', '#9f9e6e', '#a09e6d', '#a19e6c', '#a29d6c', '#a39d6b', '#a49d6a', '#a59d6a', '#a69d69', '#a79d68', '#a89d68', '#a99d67', '#aa9d67', '#ab9d66', '#ac9c65', '#ad9c65', '#ad9c64', '#ae9c63', '#af9c63', '#b09c62', '#b19c61', '#b29b61', '#b39b60', '#b49b60', '#b59b5f', '#b59b5e', '#b69b5e', '#b79b5d', '#b89a5c', '#b99a5c', '#ba9a5b', '#ba9a5b', '#bb9a5a', '#bc9a59', '#bd9959', '#be9958', '#be9957', '#bf9957', '#c09956', '#c19856', '#c19855', '#c29854', '#c39854', '#c49853', '#c49753', '#c59752', '#c69751', '#c69751', '#c79650', '#c8964f', '#c9964f', '#c9964e', '#ca964e', '#cb954d', '#cb954c', '#cc954c', '#cd954b', '#cd944b', '#ce944a', '#cf944a', '#cf9349', '#d09348', '#d19348', '#d19347', '#d29247', '#d29246', '#d39245', '#d49245', '#d49144', '#d59144', '#d59143', '#d69042', '#d79042', '#d79041', '#d88f41', '#d88f40', '#d98f40', '#d98e3f', '#da8e3e', '#db8e3e', '#db8e3d', '#dc8d3d', '#dc8d3c', '#dd8d3c', '#dd8c3b', '#de8c3a', '#de8b3a', '#df8b39', '#df8b39', '#e08a38', '#e08a38', '#e18a37', '#e18937', '#e28936', '#e28935', '#e38835', '#e38834', '#e48734', '#e48733', '#e58733', '#e58632', '#e68631', '#e68531', '#e78530', '#e78530', '#e7842f', '#e8842f', '#e8832e', '#e9832e', '#e9822d', '#ea822d', '#ea822c', '#ea812b', '#eb812b', '#eb802a', '#ec802a', '#ec7f29', '#ec7f29', '#ed7e28', '#ed7e28', '#ed7d27', '#ee7d27', '#ee7c26', '#ef7c26', '#ef7b25', '#ef7b24', '#f07a24', '#f07a23', '#f07923', '#f17922', '#f17822', '#f17821', '#f27721', '#f27720', '#f27620', '#f3761f', '#f3751f', '#f3751e', '#f4741e', '#f4731d', '#f4731d', '#f4721c', '#f5721c', '#f5711b', '#f5701a', '#f6701a', '#f66f19', '#f66f19', '#f66e18', '#f76d18', '#f76d17', '#f76c17', '#f76c16', '#f86b16', '#f86a15', '#f86a15', '#f86914', '#f96814', '#f96813', '#f96713', '#f96612', '#f96612', '#fa6511', '#fa6411', '#fa6410', '#fa6310', '#fa620f', '#fb610f', '#fb610e', '#fb600e', '#fb5f0d', '#fb5e0d', '#fc5e0c', '#fc5d0c', '#fc5c0b', '#fc5b0a', '#fc5a0a', '#fc5a09', '#fd5909', '#fd5808', '#fd5708', '#fd5608', '#fd5607', '#fd5507', '#fd5406', '#fd5306', '#fe5206', '#fe5105', '#fe5005', '#fe4f04', '#fe4e04', '#fe4d04', '#fe4c04', '#fe4b03', '#fe4a03', '#fe4903', '#ff4802', '#ff4702', '#ff4602', '#ff4502', '#ff4402', '#ff4301', '#ff4201', '#ff4101', '#ff3f01', '#ff3e01', '#ff3d01', '#ff3c00', '#ff3a00', '#ff3900', '#ff3800', '#ff3600', '#ff3500', '#ff3400', '#ff3200', '#ff3100', '#ff2f00', '#ff2d00', '#ff2c00', '#ff2a00', '#ff2800', '#ff2600', '#ff2400', '#ff2200', '#ff1f00', '#ff1d00', '#ff1a00', '#ff1700', '#ff1400', '#ff1000', '#ff0b00', '#ff0600', '#ff0000'];
        function unique(value, index, self) {
            return self.indexOf(value) === index;
        }

        function initMap() {

            function init() {
                s = 'perak'
                map = new google.maps.Map(document.getElementById("map"), {
                    center: { lat: center[s][0], lng: center[s][1] },
                    zoom: zoom[s],
                });

                function setMouseOverEvent(circle) {
                    google.maps.event.addListener(circle, 'mouseover', function (e) {
                        this.setOptions({
                            fillColor: "#000"
                        });
                    });

                    google.maps.event.addListener(circle, 'mouseout', function (e) {
                        this.setOptions({
                            fillColor: "#FF0000"
                        });
                    });
                }

                var infoWin = new google.maps.InfoWindow();

                function makeClickable(circle) {
                    google.maps.event.addListener(circle, "click", function () {
                        lat = circle.center.lat().toString()
                        long = circle.center.lng().toString()
                        nominatim = 'https://nominatim.openstreetmap.org/reverse?lat=' + lat + '&lon=' + long + '&format=json'
                        address = 'Not available'
                        $.ajax(nominatim, {
                            async: false,
                            dataType: 'json',
                            timeout: 2000,
                            success: function (data, status, xhr) {
                                try { address = data['display_name'] }
                                catch (err) { console.log(err) }

                            },
                            error: function (jqXhr, textStatus, errorMessage) {
                            }
                        })
                        latlong_string = 'Lat: ' + lat + ', ' + 'Long: ' + long + '<br>'
                        address_string = address + '<br>'
                        case_string = 'Total case: ' + circle.radius.toString()
                        infoWin.setPosition(circle.getCenter());
                        infoWin.setContent(latlong_string + address_string + case_string);
                        infoWin.open(map);
                    });
                }

  const rectangle = new google.maps.Rectangle ({
    strokeColor: "#000000",
    strokeOpacity: 1,
    strokeWeight: 0.5,
    fillColor: "#000000",
    fillOpacity: 0.,
    map,    
    bounds: {
      //north: 4.85516,
      //south: 4.84293,
      //east: 100.75484,
      //west: 100.72086,
east: 100.7576,
west: 100.72240,
south: 4.83614,
north: 4.86614
    },
  });
  
                  $.ajax(data[s], {
                    dataType: 'json',
                    timeout: 5000,
                    success: function (data, status, xhr) {
                        var datetime = xhr.getResponseHeader("Last-Modified");
                        var date = datetime.substr(0, datetime.indexOf("2021"));
                        document.getElementById("DATE").innerHTML = date;
                        console.log(document.body.innerHTML);
                        var cases = []
                        for (var i = 0; i < data.length; i++) {
                            cases.push(data[i][2]);
                        }
                        sorted_cases = cases.filter(unique);
                        sorted_numbers = sorted_cases.sort(function(a, b){return a-b});
                        console.log(sorted_numbers);
                        interval = Math.round(colors.length / sorted_numbers.length);

                        for (var i = 0; i < data.length; i++) {
                                color_index = sorted_numbers.indexOf(data[i][2]) * interval;
                                color = colors[color_index]
                                const Circle = new google.maps.Circle({
                                    strokeColor: color,
                                    strokeOpacity: 1,
                                    strokeWeight: 1,
                                    fillColor: color,
                                    fillOpacity: 0.5,
                                    map,
                                    center: { lat: data[i][0], lng: data[i][1] },
                                    radius: 40,
                                });
                        }

                        for (var i = 0; i < data.length; i++) {
                                var Label = new google.maps.Marker({
                                    label: {
                                     text: data[i][2].toString(),
                                     color: "white"
                                    },
                                    position: new google.maps.LatLng(data[i][0], data[i][1]),
                                    map: map,
                                    fontSize: 10,
                                    align: 'right'
                                });
                        }
                    },
                    error: function (jqXhr, textStatus, errorMessage) {
                        alert('Error to get json data from https://github.com/huseinzol05/project-suka-suka/tree/main/mysejahtera-hotspot, please try again');
                    }
                });
                
                /*
                $.ajax(data[s], {
                    dataType: 'json',
                    timeout: 5000,
                    success: function (data, status, xhr) {
                    
                        var cases = []
                        for (var i = 0; i < data.length; i++) {
                            cases.push(data[i][2]);
                        }
                        sorted_cases = cases.filter(unique);
                        sorted_numbers = sorted_cases.sort(function(a, b){return a-b});
                        console.log(sorted_numbers);
                        interval = Math.round(colors.length / sorted_numbers.length);
                        
                        for (var i = 0; i < data.length; i++) {
                            if (data[i][2] > 0) {
                                color_index = sorted_numbers.indexOf(data[i][2]) * interval;
                                color = colors[color_index]
                                //console.log(data[i][2] + "," + color_index)
                                const Circle = new google.maps.Circle({
                                    strokeColor: color,
                                    strokeOpacity: 0.8,
                                    strokeWeight: 1,
                                    fillColor: color,
                                    fillOpacity: 0.8,
                                    map,
                                    center: { lat: data[i][0], lng: data[i][1] },
                                    radius: 6,
                                });
                               //setMouseOverEvent(Circle);
                               //makeClickable(Circle);


                            }

                        }

                    },
                    error: function (jqXhr, textStatus, errorMessage) {
                        alert('Error to get json data from https://github.com/huseinzol05/project-suka-suka/tree/main/mysejahtera-hotspot, please try again');
                    }
                });
                */
            }

            init();

            $('#states').on('change', function () {
                init();
            });
        }


    </script>

</head>

<body>
    <div id="map"></div>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDKcq8q3GX6Sf3UUrYnxjdJ2J9fs1_xzxc&callback=initMap&libraries=&v=weekly"
        async></script>
</body>

</html>